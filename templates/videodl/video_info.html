{% extends "base.html" %}

{% block extrajs %}
<script type="text/javascript">
$("#video_info_download_form").submit(function( event ) {
    // cancels the form's submit action
    // event.preventDefault();

    // informs the user the download will begin
    var new_elem = [
        '<div class="alert alert-success">',
        '<i class="fa fa-2x fa-spinner fa-spin"></i>',
        '<button type="button" class="close" data-dismiss="alert">Ã—</button>',
        'Your download will begin shortly.',
        '</div>'].join('\n');
    $(".messages").append(new_elem);
    $('button[type="submit"]').attr('disabled', 'disabled');

    /*
    // handles the post and progress with jQuery
    var form = $(this);
    jQuery.ajax({
        url: form.attr("action"),
        method: 'POST',
        data: form.serialize()
    }).done(function (response) {
        // Do something with the response
        alert("Done");
    }).fail(function () {
        // Whoops; show an error.
        // alert("Error");
    }).always(function () {
        $('button[type="submit"]').removeAttr('disabled');
    });
    */
});
</script>
{% endblock extrajs %}

{% block title %}{{ video_title }}{% endblock %}

{% block content %}
<div class="text-center">
  <img src="{{ video_thumbnail }}" alt="{{ video_title }}" class="img-thumbnail">

  <form action="{% url 'download_video' download_link_uuid=download_link_uuid %}" method="post"
    id="video_info_download_form" class="form-inline" role="form">{% csrf_token %}
    {{ form.non_field_errors }}
    {% for field in form %}
    <div class="form-group">
      {{ field.errors }}
      {{ field }}
    </div>
    {% endfor %}
  
    <div class="btn-group">
      <button type="submit" class="btn btn-default">
      <i class="fa fa-{{ form.audio_only.value|yesno:"music,film" }}"></i> Download {{ form.audio_only.value|yesno:"audio,video" }}</button>
      <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
        <span class="caret"></span>
        <span class="sr-only">Toggle Dropdown</span>
      </button>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="#" onclick="$('input[name=audio_only]').val('False'); $('#video_info_download_form').submit();">
          <i class="fa fa-film"></i> Download video</a>
        </li>
        <li>
          <a href="#" onclick="$('input[name=audio_only]').val('True'); $('#video_info_download_form').submit();">
          <i class="fa fa-music"></i> Download audio</a>
        </li>
      </ul>
    </div>
  </form>
</div> <!-- text-centered -->
{% endblock content %}
